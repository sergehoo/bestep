{% extends "account/_base.html" %}
{% load i18n static %}

{% block head_title %}Connexion — Best-Épargne{% endblock %}

{% block content %}
  <!-- Header premium -->
  <div class="text-center">
 

    <h1 class=" text-2xl font-extrabold text-gray-900 tracking-tight">
      Connexion
    </h1>
    <p class="text-sm text-gray-500 mt-1">
      Accédez à votre espace Best-Épargne
    </p>

    <!-- mini trust badges -->
    <div class="mt-4 flex flex-wrap items-center justify-center gap-2">
      <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-sky-50 text-sky-700 text-xs font-semibold border border-sky-100">
        <i class="fas fa-shield-halved"></i> Sécurisé
      </span>
      <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-yellow-50 text-yellow-800 text-xs font-semibold border border-yellow-100">
        <i class="fas fa-award"></i> Certifiant
      </span>
      <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-green-50 text-green-700 text-xs font-semibold border border-green-100">
        <i class="fas fa-bolt"></i> Accès rapide
      </span>
    </div>
  </div>

  <!-- Alerts -->
  {% if form.non_field_errors %}
    <div class="mt-6 rounded-2xl border border-red-100 bg-red-50 p-4">
      <div class="flex gap-3">
        <div class="w-9 h-9 rounded-xl bg-red-100 flex items-center justify-center">
          <i class="fas fa-triangle-exclamation text-red-600"></i>
        </div>
        <div class="text-sm text-red-800">
          <div class="font-semibold">Impossible de se connecter</div>
          <div class="mt-1">{{ form.non_field_errors }}</div>
        </div>
      </div>
    </div>
  {% endif %}

  <!-- Form -->
  <form method="post" action="{% url 'account_login' %}" class="mt-6 space-y-4">
    {% csrf_token %}

    <!-- Email -->
    <div class="space-y-1.5">
      <label class="text-sm font-semibold text-gray-800">Email</label>
      <div class="relative">
        <span class="pointer-events-none absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
          <i class="fas fa-envelope"></i>
        </span>

        {# NOTE: le champ vient d'allauth; il sera stylé si tu ajoutes les widgets dans forms.py #}
        {{ form.login }}

        <span class="pointer-events-none absolute inset-y-0 right-0 pr-3 flex items-center text-gray-300">
          <i class="fas fa-circle-check"></i>
        </span>
      </div>
      {% if form.login.errors %}
        <p class="text-xs text-red-600">{{ form.login.errors|striptags }}</p>
      {% else %}
        <p class="text-[11px] text-gray-500">Ex: nom@domaine.com</p>
      {% endif %}
    </div>

    <!-- Password -->
    <div class="space-y-1.5">
      <label class="text-sm font-semibold text-gray-800">Mot de passe</label>

      <div class="relative">
        <span class="pointer-events-none absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
          <i class="fas fa-key"></i>
        </span>

        {{ form.password }}

        <!-- Toggle (JS ci-dessous) -->
        <button type="button"
                id="toggle-password"
                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 transition"
                aria-label="Afficher/Masquer le mot de passe">
          <i class="fas fa-eye"></i>
        </button>
      </div>

      {% if form.password.errors %}
        <p class="text-xs text-red-600">{{ form.password.errors|striptags }}</p>
      {% endif %}
    </div>

    <!-- Remember + reset -->
    <div class="flex items-center justify-between text-sm pt-1">
      <label class="flex items-center gap-2 text-gray-700 select-none">
        {{ form.remember }}
        <span>Se souvenir de moi</span>
      </label>
      <a href="{% url 'account_reset_password' %}" class="text-sky-600 font-semibold hover:underline">Mot de passe oublié ?</a>
    </div>

    <!-- CTA -->
    <button
      class="group w-full mt-2 py-3 rounded-2xl bg-gradient-to-r from-sky-600 to-sky-500 text-white font-semibold shadow-lg shadow-sky-200 hover:shadow-sky-300 hover:brightness-[1.02] transition flex items-center justify-center gap-2">
      <i class="fas fa-right-to-bracket"></i>
      <span>Se connecter</span>
      <span class="ml-1 opacity-80 group-hover:translate-x-0.5 transition-transform">→</span>
    </button>

    <!-- Divider -->
    <div class="relative py-2">
      <div class="h-px bg-gray-200"></div>
      <div class="absolute inset-0 flex items-center justify-center">
        <span class="px-3 text-xs text-gray-500 bg-white">ou</span>
      </div>
    </div>

    <!-- Secondary actions -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
      <a href="{% url 'account_signup' %}" class="w-full py-3 rounded-2xl bg-white border border-gray-200 text-gray-900 font-semibold text-center hover:bg-gray-50 hover:border-gray-300 transition">
        Créer un compte
      </a>

      <a href="/"
         class="w-full py-3 rounded-2xl bg-white border border-gray-200 text-gray-700 font-semibold text-center hover:bg-gray-50 hover:border-gray-300 transition">
        Retour à l’accueil
      </a>
    </div>

    <!-- Small footer note -->
    <div class="mt-2 rounded-2xl border border-gray-100 bg-gray-50 p-4">
      <div class="flex gap-3">
        <div class="w-9 h-9 rounded-xl bg-white border border-gray-200 flex items-center justify-center">
          <i class="fas fa-circle-info text-gray-600"></i>
        </div>
        <div class="text-xs text-gray-600 leading-relaxed">
          <div class="font-semibold text-gray-800">Conseil</div>
          Utilisez une adresse email valide. Pour protéger votre compte, évitez les mots de passe faibles.
        </div>
      </div>
    </div>
  </form>

  <!-- JS: show/hide password -->
  <script>
    (function () {
      const btn = document.getElementById("toggle-password");
      if (!btn) return;

      // essaie de récupérer l'input rendu par allauth
      const pwd = document.querySelector('input[type="password"][name="password"], input[type="password"]');
      if (!pwd) return;

      btn.addEventListener("click", () => {
        const isPwd = pwd.getAttribute("type") === "password";
        pwd.setAttribute("type", isPwd ? "text" : "password");
        btn.innerHTML = isPwd ? '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
      });
    })();
  </script>

  <!-- IMPORTANT: styles pour les champs Allauth si widgets pas encore stylés -->
  <style>
    /* Si Allauth rend les inputs sans classes, on force un style premium */
    form input[type="text"],
    form input[type="email"],
    form input[type="password"]{
      width: 100%;
      padding: 0.75rem 2.75rem 0.75rem 2.5rem; /* left icon + right btn */
      border-radius: 1rem;
      border: 1px solid rgb(229 231 235);
      background: rgb(249 250 251);
      outline: none;
      transition: box-shadow .2s ease, border-color .2s ease, background .2s ease;
    }
    form input[type="text"]:focus,
    form input[type="email"]:focus,
    form input[type="password"]:focus{
      background: #fff;
      border-color: rgba(56, 189, 248, .5);
      box-shadow: 0 0 0 4px rgba(56, 189, 248, .18);
    }
    form input[type="checkbox"]{
      width: 1rem;
      height: 1rem;
      border-radius: .35rem;
      border: 1px solid rgb(209 213 219);
      accent-color: #0284c7; /* sky-600 */
    }
  </style>
{% endblock %}