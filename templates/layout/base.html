{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Best-Épargne - Plateforme e-Learning Premium</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    * { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }

    :root{
      --primary-blue:#4A90E2;
      --primary-yellow:#FFD166;
      --light-blue:#E8F4FD;
      --success-green:#2ECC71;
    }

    .sidebar-active{
      background:#E8F4FD;
      border-left:4px solid #4A90E2;
      color:#4A90E2;
      font-weight:600;
    }

    @keyframes fadeInUp{
      from{opacity:0;transform:translateY(30px);}
      to{opacity:1;transform:translateY(0);}
    }
    .animate-fade-in-up{animation:fadeInUp .6s ease-out forwards;}
    .animate-delay-1{animation-delay:.2s;}
    .animate-delay-2{animation-delay:.4s;}
    .animate-delay-3{animation-delay:.6s;}

    /* Udemy-like card hover */
    .card-lift{transition:transform .16s ease, box-shadow .16s ease, border-color .16s ease;}
    .card-lift:hover{transform:translateY(-2px); box-shadow:0 18px 40px rgba(2,6,23,.12); border-color: rgba(148,163,184,.75);}

    .img-zoom img{transition:transform .22s ease;}
    .card-lift:hover .img-zoom img{transform:scale(1.04);}

    .line-clamp-2{
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }
    .line-clamp-3{
      display:-webkit-box;
      -webkit-line-clamp:3;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }

    /* Skeleton shimmer */
    @keyframes shimmer{0%{background-position:-600px 0;} 100%{background-position:600px 0;}}
    .skeleton{
      background:linear-gradient(90deg,#f1f5f9 25%,#e2e8f0 37%,#f1f5f9 63%);
      background-size:1200px 100%;
      animation:shimmer 1.2s infinite linear;
    }

    /* Tiny tooltip */
    .tooltip{position:relative;}
    .tooltip:hover .tooltip-box{opacity:1; transform:translateY(0); pointer-events:auto;}
    .tooltip-box{
      opacity:0; pointer-events:none;
      position:absolute; top:100%; left:0; z-index:60;
      width:min(420px, 92vw);
      transform:translateY(6px);
      transition:opacity .16s ease, transform .16s ease;
    }
  </style>
</head>

<body class="bg-gray-50 text-slate-900">

<!-- NAV -->
<nav class="bg-white shadow-md sticky top-0 z-50">
  <div class="container mx-auto px-4 py-3 flex justify-between items-center">
    <div class="flex items-center space-x-2">
      <a href="/" class="flex items-center space-x-2">
        <div class="w-10 h-10 rounded-lg bg-white flex items-center justify-center">
          <span class="text-white font-bold text-xl">
            <img src="{% static 'img/logo_img.png' %}" width="70" height="auto" alt="Best-Épargne">
          </span>
        </div>
        <div>
          <h1 class="text-2xl font-bold text-blue-600">Best-<span class="text-yellow-500">Épargne</span></h1>
          <p class="text-xs text-gray-500 -mt-1">Apprentissage financier</p>
        </div>
      </a>
    </div>

    <div class="hidden md:flex space-x-8">
      <a href="#" class="text-blue-600 font-semibold border-b-2 border-blue-600 pb-1">Accueil</a>
      <a href="#features" class="text-gray-600 hover:text-blue-600 transition">Fonctionnalités</a>
      <a href="#formateur" class="text-gray-600 hover:text-blue-600 transition">Bénéficiaires</a>
      <a href="#cours" class="text-gray-600 hover:text-blue-600 transition">Cours</a>
      <a href="#faq" class="text-gray-600 hover:text-blue-600 transition">FAQ</a>
    </div>

    <div class="flex items-center space-x-4">
      {% if user.is_authenticated %}
        <div class="hidden md:flex items-center space-x-4">
          <div class="flex items-center space-x-3">
            <div class="w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-blue-400 flex items-center justify-center">
              <span class="text-white font-semibold text-sm">
                {{ user.first_name|first|default:user.get_username|first|upper }}
              </span>
            </div>
            <div class="text-sm">
              <div class="font-semibold">
                {% if user.first_name %}{{ user.first_name }} {{ user.last_name|default:"" }}{% else %}
                  {{ user.get_username }}{% endif %}
              </div>
              <div class="text-xs text-gray-500">
                {% if user.userprofile.is_instructor %}
                  Formateur{% elif user.userprofile.is_enterprise %}Entreprise{% else %}
                  Apprenant{% endif %}
              </div>
            </div>
          </div>
          <div class="h-6 w-px bg-gray-300"></div>
          <a href="{% url 'account_logout' %}"
             class="px-4 py-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition">
            <i class="fas fa-sign-out-alt mr-2"></i>Déconnexion
          </a>
        </div>
      {% else %}
        <div class="hidden md:flex items-center space-x-4">
          <a href="{% url 'account_login' %}"
             class="px-4 py-2 text-blue-600 hover:bg-blue-50 rounded-lg transition">
            <i class="fas fa-sign-in-alt mr-2"></i>Connexion
          </a>
          <a href="{% url 'account_signup' %}"
             class="bg-gradient-to-r from-blue-600 to-blue-500 text-white px-5 py-2.5 rounded-lg font-semibold shadow-md hover:shadow-lg transition flex items-center">
            <i class="fas fa-user-plus mr-2"></i>S'inscrire
          </a>
        </div>
      {% endif %}

      <button id="mobile-menu-btn" class="md:hidden text-gray-700">
        <i class="fas fa-bars text-xl"></i>
      </button>
    </div>
  </div>

  <div id="mobile-menu" class="md:hidden hidden bg-white px-4 py-3 border-t">
    <div class="flex flex-col space-y-3">
      <a href="#" class="text-blue-600 font-semibold py-2">Accueil</a>
      <a href="#features" class="text-gray-600 py-2">Fonctionnalités</a>
      <a href="#formateur" class="text-gray-600 py-2">Bénéficiaires</a>
      <a href="#cours" class="text-gray-600 py-2">Cours</a>
      <a href="#faq" class="text-gray-600 py-2">FAQ</a>

      {% if user.is_authenticated %}
        <div class="border-t pt-3">
          <a href="{% url 'account_logout' %}" class="text-blue-600 py-2 block">
            <i class="fas fa-sign-out-alt mr-2"></i>Déconnexion
          </a>
        </div>
      {% else %}
        <div class="border-t pt-3">
          <a href="{% url 'account_login' %}" class="text-blue-600 py-2 block">
            <i class="fas fa-sign-in-alt mr-2"></i>Connexion
          </a>
          <a href="{% url 'account_signup' %}"
             class="bg-gradient-to-r from-blue-600 to-blue-500 text-white px-4 py-2 rounded-lg font-medium w-full text-center block mt-2">
            <i class="fas fa-user-plus mr-2"></i>S'inscrire
          </a>
        </div>
      {% endif %}
    </div>
  </div>
</nav>

<!-- HERO -->
<section class="bg-gradient-to-r from-blue-50 to-blue-100 py-12 md:py-20 overflow-hidden">
  <div class="container mx-auto px-4">
    <div class="flex flex-col md:flex-row items-center">
      <div class="md:w-1/2 mb-10 md:mb-0 animate-fade-in-up">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-800 leading-tight">
          Devenez expert en <span class="text-blue-600">gestion financière</span>
        </h1>
        <p class="text-gray-600 text-lg mt-6 mb-8">
          Formations certifiantes par des experts, pour particuliers, entreprises et professionnels.
        </p>

        <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
          <a href="#cours"
             class="bg-gradient-to-r from-blue-600 to-blue-500 text-white px-6 py-3 rounded-lg font-semibold shadow-md hover:shadow-lg transition flex items-center justify-center">
            <i class="fas fa-play-circle mr-2"></i> Découvrir les cours
          </a>
          <a href="{% url 'account_signup' %}"
             class="bg-white text-blue-600 border border-blue-600 px-6 py-3 rounded-lg font-semibold shadow-sm hover:shadow transition flex items-center justify-center">
            <i class="fas fa-rocket mr-2"></i> Essai gratuit 14 jours
          </a>
        </div>

        <div class="mt-12 grid grid-cols-3 gap-6 text-center">
          <div>
            <p class="text-3xl font-bold text-blue-600 stat-counter" data-target="12457">0</p>
            <p class="text-gray-600 text-sm">Apprenants certifiés</p>
          </div>
          <div>
            <p class="text-3xl font-bold text-yellow-500 stat-counter" data-target="528">0</p>
            <p class="text-gray-600 text-sm">Entreprises partenaires</p>
          </div>
          <div>
            <p class="text-3xl font-bold text-green-500 stat-counter" data-target="187">0</p>
            <p class="text-gray-600 text-sm">Experts formateurs</p>
          </div>
        </div>
      </div>

      <div class="md:w-1/2 flex justify-center animate-fade-in-up animate-delay-1">
        <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-md card-lift border border-transparent">
          {% if user.is_authenticated %}
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-xl font-bold text-gray-800">
                Bon retour, {{ user.first_name|default:user.get_username }}!
              </h3>
              <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
                <span class="text-blue-600 font-bold">
                  {{ user.first_name|first|default:user.get_username|first|upper }}
                </span>
              </div>
            </div>

            <div class="text-center py-6">
              <div class="w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-book-open text-blue-600 text-2xl"></i>
              </div>
              <h4 class="text-lg font-semibold text-gray-800 mb-2">Reprenez votre apprentissage</h4>
              <p class="text-gray-600 mb-4">Accédez à votre tableau de bord et continuez vos cours</p>
              <a href="{% url 'learner_dashboard' %}"
                 class="inline-block bg-gradient-to-r from-blue-600 to-blue-500 text-white px-6 py-2 rounded-lg font-medium">
                Aller au tableau de bord
              </a>
            </div>
          {% else %}
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-xl font-bold text-gray-800">Tableau de bord apprenant</h3>
              <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
                <span class="text-blue-600 font-bold">JD</span>
              </div>
            </div>

            <div class="mb-6">
              <div class="flex justify-between mb-2">
                <p class="text-gray-700">Progression globale</p>
                <p class="text-blue-600 font-bold">68%</p>
              </div>
              <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                <div class="h-full bg-gradient-to-r from-blue-500 to-green-400" style="width: 68%"></div>
              </div>
            </div>

            <a href="{% url 'account_signup' %}"
               class="w-full mt-6 py-3 bg-gradient-to-r from-blue-600 to-blue-500 text-white rounded-lg font-medium hover:shadow-lg transition block text-center">
              Rejoindre la plateforme
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</section>

<!-- LOGOS -->
<section class="py-10 bg-white border-b">
  <div class="container mx-auto px-4">
    <div class="flex flex-col md:flex-row items-center justify-between gap-6">
      <div>
        <h3 class="text-lg font-semibold text-gray-800">Ils nous font confiance</h3>
        <p class="text-sm text-gray-500">Banques, fintechs, cabinets & PME partenaires</p>
      </div>
      <div class="grid grid-cols-3 sm:grid-cols-5 gap-4 w-full md:w-auto opacity-80">
        <div class="h-10 bg-gray-100 rounded-lg"></div>
        <div class="h-10 bg-gray-100 rounded-lg"></div>
        <div class="h-10 bg-gray-100 rounded-lg"></div>
        <div class="h-10 bg-gray-100 rounded-lg hidden sm:block"></div>
        <div class="h-10 bg-gray-100 rounded-lg hidden sm:block"></div>
      </div>
    </div>
  </div>
</section>

<!-- HOW IT WORKS -->
<section class="py-16 bg-gray-50">
  <div class="container mx-auto px-4">
    <div class="text-center mb-12">
      <h2 class="text-3xl font-bold text-gray-800">
        Comment ça marche <span class="text-blue-600">en 3 étapes</span>
      </h2>
      <p class="text-gray-600 mt-2 max-w-2xl mx-auto">
        Une expérience d’apprentissage guidée, adaptée aux particuliers, entreprises et formateurs.
      </p>
    </div>

    <div class="grid md:grid-cols-3 gap-8">
      <div class="bg-white rounded-2xl p-8 shadow card-lift border border-gray-100">
        <div class="w-14 h-14 rounded-xl bg-blue-100 flex items-center justify-center mb-5">
          <i class="fas fa-magnifying-glass text-blue-600 text-xl"></i>
        </div>
        <h3 class="text-xl font-bold text-gray-800">1) Explorez</h3>
        <p class="text-gray-600 mt-2">Recherchez un cours par thème, niveau, prix, popularité.</p>
      </div>

      <div class="bg-white rounded-2xl p-8 shadow card-lift border border-gray-100">
        <div class="w-14 h-14 rounded-xl bg-yellow-100 flex items-center justify-center mb-5">
          <i class="fas fa-circle-play text-yellow-600 text-xl"></i>
        </div>
        <h3 class="text-xl font-bold text-gray-800">2) Apprenez</h3>
        <p class="text-gray-600 mt-2">Vidéos, quiz, supports, progression, rappels et objectifs.</p>
      </div>

      <div class="bg-white rounded-2xl p-8 shadow card-lift border border-gray-100">
        <div class="w-14 h-14 rounded-xl bg-green-100 flex items-center justify-center mb-5">
          <i class="fas fa-award text-green-600 text-xl"></i>
        </div>
        <h3 class="text-xl font-bold text-gray-800">3) Validez</h3>
        <p class="text-gray-600 mt-2">Badges, certificats, parcours recommandés, suivi entreprise.</p>
      </div>
    </div>
  </div>
</section>

<!-- FEATURES -->
<section id="features" class="py-16 bg-white">
  <div class="container mx-auto px-4">
    <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6 mb-12">
      <div>
        <h2 class="text-3xl font-bold text-gray-800">
          Une expérience <span class="text-blue-600">premium</span>
        </h2>
        <p class="text-gray-600 mt-2 max-w-2xl">
          Tout ce qu’il faut pour apprendre vite, bien, et suivre l’impact (apprenant, entreprise, formateur).
        </p>
      </div>
      <div class="flex gap-3">
        <div class="px-4 py-2 rounded-xl bg-blue-50 text-blue-700 text-sm font-medium">
          <i class="fas fa-shield-halved mr-2"></i>Sécurisé
        </div>
        <div class="px-4 py-2 rounded-xl bg-green-50 text-green-700 text-sm font-medium">
          <i class="fas fa-chart-line mr-2"></i>Analytique
        </div>
        <div class="px-4 py-2 rounded-xl bg-yellow-50 text-yellow-700 text-sm font-medium">
          <i class="fas fa-star mr-2"></i>Certifiant
        </div>
      </div>
    </div>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
      <div class="rounded-2xl border border-gray-100 p-6 card-lift">
        <div class="w-12 h-12 rounded-xl bg-blue-100 flex items-center justify-center mb-4">
          <i class="fas fa-bullseye text-blue-600"></i>
        </div>
        <h4 class="font-semibold text-gray-800">Parcours & objectifs</h4>
        <p class="text-sm text-gray-600 mt-1">Parcours par métier, niveau et ambition (épargne, investissement, budget).</p>
      </div>

      <div class="rounded-2xl border border-gray-100 p-6 card-lift">
        <div class="w-12 h-12 rounded-xl bg-green-100 flex items-center justify-center mb-4">
          <i class="fas fa-clipboard-check text-green-600"></i>
        </div>
        <h4 class="font-semibold text-gray-800">Quiz & validations</h4>
        <p class="text-sm text-gray-600 mt-1">Quiz, devoirs, scoring, et prérequis par chapitre.</p>
      </div>

      <div class="rounded-2xl border border-gray-100 p-6 card-lift">
        <div class="w-12 h-12 rounded-xl bg-yellow-100 flex items-center justify-center mb-4">
          <i class="fas fa-award text-yellow-600"></i>
        </div>
        <h4 class="font-semibold text-gray-800">Certificats</h4>
        <p class="text-sm text-gray-600 mt-1">Certificats téléchargeables et partageables.</p>
      </div>

      <div class="rounded-2xl border border-gray-100 p-6 card-lift">
        <div class="w-12 h-12 rounded-xl bg-purple-100 flex items-center justify-center mb-4">
          <i class="fas fa-users-gear text-purple-600"></i>
        </div>
        <h4 class="font-semibold text-gray-800">Gestion entreprise</h4>
        <p class="text-sm text-gray-600 mt-1">Équipes, cohortes, budgets, rapports exportables.</p>
      </div>

      <div class="rounded-2xl border border-gray-100 p-6 card-lift">
        <div class="w-12 h-12 rounded-xl bg-rose-100 flex items-center justify-center mb-4">
          <i class="fas fa-hand-holding-dollar text-rose-600"></i>
        </div>
        <h4 class="font-semibold text-gray-800">Monétisation formateur</h4>
        <p class="text-sm text-gray-600 mt-1">Vente de cours, performance, revenus, avis et stats.</p>
      </div>

      <div class="rounded-2xl border border-gray-100 p-6 card-lift">
        <div class="w-12 h-12 rounded-xl bg-slate-100 flex items-center justify-center mb-4">
          <i class="fas fa-bell text-slate-700"></i>
        </div>
        <h4 class="font-semibold text-gray-800">Rappels & notifications</h4>
        <p class="text-sm text-gray-600 mt-1">Relances, objectifs hebdo, alertes quiz.</p>
      </div>
    </div>
  </div>
</section>

<!-- ESPACES -->
<section class="py-16 bg-white">
  <div class="container mx-auto px-4">
    <h2 class="text-3xl font-bold text-center text-gray-800 mb-12">
      Une plateforme <span class="text-blue-600">complète</span> pour tous vos besoins
    </h2>

    <div class="grid md:grid-cols-3 gap-8">
      <div id="apprenant" class="bg-gradient-to-br from-blue-50 to-white rounded-2xl shadow-lg p-8 border border-blue-100 card-lift">
        <div class="w-16 h-16 rounded-xl bg-gradient-to-r from-blue-500 to-blue-400 flex items-center justify-center mb-6">
          <i class="fas fa-user-graduate text-white text-2xl"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-800 mb-4">Espace Apprenant</h3>
        <p class="text-gray-600 mb-6">Parcours personnalisés, progression, certifications et communauté.</p>
        <ul class="space-y-3 mb-8">
          <li class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-3"></i><span>Dashboard de progression</span></li>
          <li class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-3"></i><span>Cours recommandés</span></li>
          <li class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-3"></i><span>Certificats</span></li>
        </ul>
        {% if not user.is_authenticated %}
          <a href="{% url 'account_signup' %}?role=learner"
             class="bg-gradient-to-r from-blue-600 to-blue-500 text-white px-5 py-3 rounded-lg font-medium w-full hover:shadow-lg transition block text-center">
            S'inscrire comme apprenant
          </a>
        {% else %}
          <a href="{% url 'learner_dashboard' %}"
             class="bg-gradient-to-r from-blue-600 to-blue-500 text-white px-5 py-3 rounded-lg font-medium w-full hover:shadow-lg transition block text-center">
            Accéder à mon espace
          </a>
        {% endif %}
      </div>

      <div id="entreprise" class="bg-gradient-to-br from-yellow-50 to-white rounded-2xl shadow-lg p-8 border border-yellow-100 card-lift">
        <div class="w-16 h-16 rounded-xl bg-gradient-to-r from-yellow-500 to-yellow-400 flex items-center justify-center mb-6">
          <i class="fas fa-building text-white text-2xl"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-800 mb-4">Espace Entreprise</h3>
        <p class="text-gray-600 mb-6">Formez vos équipes et suivez les compétences.</p>
        <ul class="space-y-3 mb-8">
          <li class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-3"></i><span>Dashboard analytique</span></li>
          <li class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-3"></i><span>Gestion des équipes</span></li>
          <li class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-3"></i><span>Rapports exportables</span></li>
        </ul>

        {% if not user.is_authenticated %}
          <a href="{% url 'account_signup' %}?role=enterprise"
             class="bg-gradient-to-r from-yellow-500 to-yellow-400 text-white px-5 py-3 rounded-lg font-medium w-full hover:shadow-lg transition block text-center">
            S'inscrire comme entreprise
          </a>
        {% else %}
          <a href="{% url 'learner_dashboard' %}"
             class="bg-gradient-to-r from-yellow-500 to-yellow-400 text-white px-5 py-3 rounded-lg font-medium w-full hover:shadow-lg transition block text-center">
            Accéder à l'espace entreprise
          </a>
        {% endif %}
      </div>

      <div id="formateur" class="bg-gradient-to-br from-green-50 to-white rounded-2xl shadow-lg p-8 border border-green-100 card-lift">
        <div class="w-16 h-16 rounded-xl bg-gradient-to-r from-green-500 to-green-400 flex items-center justify-center mb-6">
          <i class="fas fa-chalkboard-teacher text-white text-2xl"></i>
        </div>
        <h3 class="text-2xl font-bold text-gray-800 mb-4">Espace Formateur</h3>
        <p class="text-gray-600 mb-6">Créez, publiez et suivez vos performances.</p>
        <ul class="space-y-3 mb-8">
          <li class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-3"></i><span>Création avancée</span></li>
          <li class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-3"></i><span>Analytique</span></li>
          <li class="flex items-center"><i class="fas fa-check-circle text-green-500 mr-3"></i><span>Paiements & rapports</span></li>
        </ul>

        {% if not user.is_authenticated %}
          <a href="{% url 'account_signup' %}?role=instructor"
             class="bg-gradient-to-r from-green-500 to-green-400 text-white px-5 py-3 rounded-lg font-medium w-full hover:shadow-lg transition block text-center">
            Devenir formateur
          </a>
        {% else %}
          <a href="{% url 'learner_dashboard' %}"
             class="bg-gradient-to-r from-green-500 to-green-400 text-white px-5 py-3 rounded-lg font-medium w-full hover:shadow-lg transition block text-center">
            Accéder à l'espace formateur
          </a>
        {% endif %}
      </div>
    </div>
  </div>
</section>

<!-- CATALOGUE -->
<section id="cours" class="py-16 bg-gray-50">
  <div class="container mx-auto px-4">

    <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-6 mb-8">
      <div>
        <h2 class="text-3xl font-bold text-gray-800">
          Catalogue de <span class="text-blue-600">cours</span>
        </h2>
        <p class="text-gray-600 mt-2">Recherchez, filtrez et explorez les cours publiés.</p>
      </div>

      <div class="flex flex-wrap items-center gap-3">
        <div class="px-3 py-2 bg-white border border-gray-200 rounded-xl text-sm text-gray-600">
          <i class="fas fa-layer-group mr-2 text-blue-600"></i>
          <span id="courses-count">0</span> cours
        </div>

        <!-- Tri (Udemy-like) -->
        <div class="flex items-center gap-2">
          <button id="sort-popular"
                  class="px-4 py-2 rounded-xl bg-white border border-gray-200 text-gray-700 hover:bg-gray-100 transition text-sm font-medium">
            <i class="fas fa-fire mr-2 text-orange-500"></i>Populaires
          </button>
          <button id="sort-recent"
                  class="px-4 py-2 rounded-xl bg-white border border-gray-200 text-gray-700 hover:bg-gray-100 transition text-sm font-medium">
            <i class="far fa-clock mr-2 text-blue-600"></i>Récents
          </button>
        </div>

        <button id="reset-filters"
                class="px-4 py-2 rounded-xl bg-white border border-gray-200 text-gray-700 hover:bg-gray-100 transition">
          <i class="fas fa-rotate-left mr-2"></i>Réinitialiser
        </button>
      </div>
    </div>

    <!-- Filters -->
    <div class="bg-white border border-gray-200 rounded-2xl p-4 md:p-5 shadow-sm mb-8">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-3">

        <div class="lg:col-span-2">
          <label class="text-xs font-medium text-gray-600">Recherche</label>
          <div class="mt-1 relative">
            <i class="fas fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
            <input id="filter-q" type="text" placeholder="Titre, description, sous-titre…"
                   class="w-full pl-10 pr-3 py-2.5 rounded-xl border border-gray-200 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-200">
          </div>
        </div>

        <div>
          <label class="text-xs font-medium text-gray-600">Niveau</label>
          <select id="filter-level"
                  class="mt-1 w-full px-3 py-2.5 rounded-xl border border-gray-200 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-200">
            <option value="">Tous</option>
            <option value="beginner">Débutant</option>
            <option value="intermediate">Intermédiaire</option>
            <option value="advanced">Avancé</option>
          </select>
        </div>

        <div>
          <label class="text-xs font-medium text-gray-600">Type (API: course_type)</label>
          <select id="filter-type"
                  class="mt-1 w-full px-3 py-2.5 rounded-xl border border-gray-200 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-200">
            <option value="">Tous</option>
            <option value="ACADEMIQUE">Académique</option>
            <option value="PRO">Professionnel</option>
            <option value="BUSINESS">Entreprise</option>
            <option value="PERSONAL">Particulier</option>
          </select>
        </div>

        <div>
          <label class="text-xs font-medium text-gray-600">Tarif (API: pricing_type)</label>
          <select id="filter-pricing"
                  class="mt-1 w-full px-3 py-2.5 rounded-xl border border-gray-200 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-200">
            <option value="">Tous</option>
            <option value="FREE">Gratuit</option>
            <option value="PAID">Payant</option>
            <option value="HYBRID">Hybride</option>
          </select>
        </div>

        <div>
          <label class="text-xs font-medium text-gray-600">Mes cours</label>
          <select id="filter-mine"
                  class="mt-1 w-full px-3 py-2.5 rounded-xl border border-gray-200 bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-200"
                  {% if not user.is_authenticated %}disabled{% endif %}>
            <option value="0">Tous</option>
            <option value="1">Seulement inscrits</option>
          </select>
          {% if not user.is_authenticated %}
            <p class="text-[11px] text-gray-500 mt-1">Connectez-vous pour filtrer vos cours</p>
          {% endif %}
        </div>
      </div>

      <div class="mt-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
        <div class="text-sm text-gray-500">
          <i class="fas fa-circle-info mr-2"></i>
          Astuce : survolez une carte pour voir plus d’infos (style Udemy).
        </div>
        <div class="flex gap-2">
          <button id="apply-filters"
                  class="px-5 py-2.5 rounded-xl bg-gradient-to-r from-blue-600 to-blue-500 text-white font-medium shadow hover:shadow-lg transition">
            <i class="fas fa-filter mr-2"></i>Filtrer
          </button>
        </div>
      </div>
    </div>

    <!-- Udemy-like grid: 4 colonnes desktop -->
    <div id="courses-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5"></div>

    <div id="courses-state" class="text-center py-10 hidden">
      <div class="inline-block animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500 mb-3"></div>
      <p class="text-gray-600">Chargement des cours…</p>
    </div>

    <div class="text-center mt-10">
      <button id="load-more"
              class="hidden mx-auto px-8 py-3 rounded-xl bg-white border border-gray-200 text-gray-700 hover:bg-gray-100 transition font-semibold">
        <i class="fas fa-plus mr-2"></i>Charger plus
      </button>
    </div>
  </div>
</section>

<!-- FAQ -->
<section id="faq" class="py-16 bg-gray-50">
  <div class="container mx-auto px-4">
    <div class="text-center mb-10">
      <h2 class="text-3xl font-bold text-gray-800">FAQ</h2>
      <p class="text-gray-600 mt-2">Les questions fréquentes sur Best-Épargne.</p>
    </div>

    <div class="max-w-3xl mx-auto space-y-4">
      <details class="bg-white border border-gray-200 rounded-2xl p-5">
        <summary class="cursor-pointer font-semibold text-gray-800">Les cours sont-ils certifiants ?</summary>
        <p class="text-gray-600 mt-2">Oui, selon le cours. Les certificats sont disponibles à la fin des validations.</p>
      </details>

      <details class="bg-white border border-gray-200 rounded-2xl p-5">
        <summary class="cursor-pointer font-semibold text-gray-800">Puis-je former mes équipes ?</summary>
        <p class="text-gray-600 mt-2">Oui, l’espace entreprise permet de gérer des cohortes, suivre les progrès et exporter des rapports.</p>
      </details>

      <details class="bg-white border border-gray-200 rounded-2xl p-5">
        <summary class="cursor-pointer font-semibold text-gray-800">Comment devenir formateur ?</summary>
        <p class="text-gray-600 mt-2">Inscrivez-vous en mode formateur, puis publiez vos cours et suivez vos performances.</p>
      </details>
    </div>
  </div>
</section>

<!-- FOOTER -->
<footer class="bg-gradient-to-r from-blue-900 to-blue-800 text-white pt-10 pb-8">
  <div class="container mx-auto px-4">
    <div class="border-t border-blue-700 pt-6 flex flex-col md:flex-row justify-between items-center">
      <p class="text-blue-300 text-sm mb-4 md:mb-0">© 2026 Best-Épargne. Tous droits réservés.</p>
      <div class="flex space-x-6">
        <a href="#" class="text-blue-300 hover:text-white text-sm">Mentions légales</a>
        <a href="#" class="text-blue-300 hover:text-white text-sm">Confidentialité</a>
        <a href="#" class="text-blue-300 hover:text-white text-sm">CGU</a>
      </div>
    </div>
  </div>
</footer>

<!-- Exposer les URLs côté JS -->
<script>
  window.BE = {
    isAuth: {% if user.is_authenticated %}true{% else %}false{% endif %},
    exploreUrl: "{% url 'landing_public_courses_explore' %}",
    learnerExploreUrl: "{% url 'api_learner_courses_explore' %}"
  };
</script>

<script>
  // Menu mobile
  document.getElementById('mobile-menu-btn')?.addEventListener('click', function () {
    const menu = document.getElementById('mobile-menu');
    menu.classList.toggle('hidden');
  });

  // Animation des compteurs
  function animateCounter(element) {
    const target = parseInt(element.getAttribute('data-target') || "0", 10);
    const duration = 2000;
    const step = target / (duration / 16);
    let current = 0;

    const timer = setInterval(() => {
      current += step;
      if (current >= target) {
        current = target;
        clearInterval(timer);
      }
      element.textContent = Math.floor(current).toLocaleString('fr-FR');
    }, 16);
  }

  document.addEventListener('DOMContentLoaded', function () {
    const counters = document.querySelectorAll('.stat-counter');
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          animateCounter(entry.target);
          observer.unobserve(entry.target);
        }
      });
    }, {threshold: 0.5});

    counters.forEach(counter => observer.observe(counter));
  });
</script>

<!-- CATALOGUE JS (Udemy-like cards + API fields) -->
<script>
  const state = {
    limit: 20,          // ✅ API: limit (tu as 20 dans la réponse)
    offset: 0,          // ✅ API: offset
    loading: false,
    hasMore: true,
    lastQueryKey: "",
    sort: ""            // "popular" | "recent" | ""
  };

  const els = {
    container: document.getElementById("courses-container"),
    count: document.getElementById("courses-count"),
    loading: document.getElementById("courses-state"),
    loadMore: document.getElementById("load-more"),
    apply: document.getElementById("apply-filters"),
    reset: document.getElementById("reset-filters"),
    q: document.getElementById("filter-q"),
    level: document.getElementById("filter-level"),
    type: document.getElementById("filter-type"),
    pricing: document.getElementById("filter-pricing"),
    mine: document.getElementById("filter-mine"),
    sortPopular: document.getElementById("sort-popular"),
    sortRecent: document.getElementById("sort-recent"),
  };

  function debounce(fn, delay = 300) {
    let t = null;
    return (...args) => {
      clearTimeout(t);
      t = setTimeout(() => fn(...args), delay);
    };
  }

  function getEndpoint() {
    if (window.BE?.isAuth && window.BE?.learnerExploreUrl) return window.BE.learnerExploreUrl;
    return window.BE?.exploreUrl || "#";
  }

  function showLoading(show) {
    els.loading.classList.toggle("hidden", !show);
  }

  function renderSkeleton(count = 8) {
    const items = Array.from({length: count}).map(() => `
      <div class="bg-white rounded-2xl border border-gray-200 overflow-hidden">
        <div class="aspect-[16/9] skeleton"></div>
        <div class="p-4 space-y-3">
          <div class="h-4 rounded skeleton w-5/6"></div>
          <div class="h-3 rounded skeleton w-4/6"></div>
          <div class="h-3 rounded skeleton w-full"></div>
          <div class="h-9 rounded-xl skeleton w-full mt-2"></div>
        </div>
      </div>
    `).join("");
    els.container.innerHTML = items;
  }

  function money(amount, currency) {
    const n = Number(amount || 0);
    const cur = currency || "XOF";
    if (cur === "XOF") return n.toLocaleString("fr-FR") + " FCFA";
    return n.toLocaleString("fr-FR") + " " + cur;
  }

  function safeText(s) {
    return String(s ?? "").replaceAll("&", "&amp;").replaceAll("<", "&lt;").replaceAll(">", "&gt;");
  }

  function badge(label, color = "blue") {
    const map = {
      blue: "bg-blue-100 text-blue-700",
      green: "bg-green-100 text-green-700",
      yellow: "bg-yellow-100 text-yellow-700",
      slate: "bg-slate-100 text-slate-700",
      purple: "bg-purple-100 text-purple-700",
      rose: "bg-rose-100 text-rose-700",
      red: "bg-red-100 text-red-700",
      orange: "bg-orange-100 text-orange-700",
    };
    return `<span class="px-2.5 py-1 rounded-full text-[11px] font-semibold ${map[color] || map.blue}">${safeText(label)}</span>`;
  }

  function isoToFR(iso) {
    if (!iso) return "";
    const d = new Date(iso);
    if (isNaN(d.getTime())) return "";
    return d.toLocaleDateString("fr-FR", { year:"numeric", month:"short", day:"2-digit" });
  }

  function buildParams({resetOffset = false} = {}) {
    const q = (els.q.value || "").trim();
    const level = (els.level.value || "").trim();
    const type = (els.type.value || "").trim();
    const pricing = (els.pricing.value || "").trim();
    const mine = (els.mine?.value || "0").trim();

    if (resetOffset) {
      state.offset = 0;
      state.hasMore = true;
    }

    const params = new URLSearchParams();
    params.set("limit", String(state.limit));
    params.set("offset", String(state.offset));

    // ✅ On colle au style API que tu as montré (q / level)
    if (q) params.set("q", q);
    if (level) params.set("level", level);

    // ✅ On utilise des noms explicites côté front (si ton API attend d'autres clés, change ici)
    // Recommandé: course_type / pricing_type (aligné avec tes champs)
    if (type) params.set("course_type", type);
    if (pricing) params.set("pricing_type", pricing);

    // mine uniquement si connecté
    if (window.BE?.isAuth && mine === "1") params.set("mine", "1");

    // tri (si ton API le supporte, sinon c’est tri front fallback)
    if (state.sort) params.set("sort", state.sort);

    return params;
  }

  function pickThumbnail(course) {
    // ✅ API: thumbnail_url
    if (course.thumbnail_url) return course.thumbnail_url;

    // Fallback: “cover” visuel (gradient+icon) si pas d’image
    return null;
  }

  function renderCourseCard(course) {
    // Champs API pris en compte
    const title = course.title || "Cours";
    const subtitle = course.subtitle || "";
    const desc = course.description || "";
    const category = course.category_name || "";
    const courseType = course.course_type_label || course.course_type || "";
    const pricingLabel = course.pricing_type_label || course.pricing_type || "";
    const price = course.price;
    const currency = course.currency || "XOF";
    const pricePeriod = course.price_period || "cours";
    const status = course.status || "";
    const publishedAt = isoToFR(course.published_at);
    const companyOnly = !!course.company_only;

    const levelLabel = course.level_label || course.level || "Niveau";
    const levelColor = course.level_color || "blue";

    const enrolledCount = Number(course.enrolled_count || 0).toLocaleString("fr-FR");
    const rating = (typeof course.rating === "number") ? course.rating.toFixed(1) : (course.rating ?? "—");
    const isPopular = !!course.is_popular;

    const instructorName = course.instructor_name || "Formateur";
    const instructorInitials = course.instructor_initials || (instructorName.trim()[0] || "F");

    const thumb = pickThumbnail(course);

    const detailUrl = course.detail_url || course.preview_url || "#";
    const previewUrl = course.preview_url || detailUrl;
    const enrollUrl = course.enroll_url || detailUrl;
    const previewVideoUrl = course.preview_video_url || "";

    // CTA logique (visiteur vs connecté)
    // NB: ton endpoint learner peut renvoyer is_enrolled/continue_url : on les supporte si présents
    const isEnrolled = !!course.is_enrolled;
    const continueUrl = course.continue_url || detailUrl;

    const ctaLabel = isEnrolled ? "Continuer" : (window.BE?.isAuth ? "S'inscrire" : "Voir le cours");
    const ctaUrl = isEnrolled ? continueUrl : (window.BE?.isAuth ? enrollUrl : previewUrl);

    // Prix
    const isFree = (course.pricing_type === "FREE") || Number(price) === 0;
    const priceHtml = isFree
      ? `<div class="text-right">
           <div class="text-[13px] font-bold text-green-700">Gratuit</div>
           <div class="text-[11px] text-gray-500">Accès immédiat</div>
         </div>`
      : `<div class="text-right">
           <div class="text-[13px] font-extrabold text-slate-900">${money(price, currency)}</div>
           <div class="text-[11px] text-gray-500">/ ${safeText(pricePeriod)}</div>
         </div>`;

    // Header badges
    const badges = `
      <div class="absolute top-3 left-3 flex flex-wrap gap-2">
        ${isPopular ? `<span class="px-2.5 py-1 rounded-full text-[11px] font-semibold bg-yellow-500 text-white"><i class="fas fa-star mr-1"></i>Populaire</span>` : ""}
        ${badge(levelLabel, levelColor)}
        ${pricingLabel ? badge(pricingLabel, (course.pricing_type === "PAID" ? "blue" : (course.pricing_type === "HYBRID" ? "yellow" : "green"))) : ""}
        ${companyOnly ? badge("Entreprise", "purple") : ""}
      </div>
    `;

    // Udemy-like mini "hover panel" (tooltip) avec infos complètes
    const hoverPanel = `
      <div class="tooltip-box">
        <div class="bg-white border border-gray-200 rounded-2xl shadow-2xl p-4">
          <div class="flex items-start justify-between gap-3">
            <div class="min-w-0">
              <div class="font-extrabold text-slate-900 text-sm leading-snug">${safeText(title)}</div>
              <div class="text-xs text-gray-500 mt-1">
                ${publishedAt ? `Publié ${publishedAt}` : ""}
                ${status ? `${publishedAt ? " • " : ""}${safeText(status)}` : ""}
              </div>
            </div>
            <div class="shrink-0">
              ${priceHtml}
            </div>
          </div>

          <div class="mt-2 flex flex-wrap gap-2">
            ${category ? badge(category, "slate") : ""}
            ${courseType ? badge(courseType, "slate") : ""}
            ${pricingLabel ? badge(pricingLabel, "slate") : ""}
          </div>

          ${desc ? `<div class="text-sm text-gray-600 mt-3 line-clamp-3">${safeText(desc)}</div>` : ""}

          <div class="mt-3 flex items-center justify-between text-xs text-gray-500">
            <div class="flex items-center gap-2">
              <span class="inline-flex items-center gap-1 text-yellow-600 font-semibold">
                <i class="fas fa-star"></i> ${rating}
              </span>
              <span class="text-gray-300">•</span>
              <span class="inline-flex items-center gap-1">
                <i class="fas fa-users"></i> ${enrolledCount}
              </span>
            </div>

            ${previewVideoUrl ? `<span class="inline-flex items-center gap-1 text-blue-600 font-semibold"><i class="fas fa-circle-play"></i> Vidéo</span>` : ""}
          </div>

          <div class="mt-3">
            <a href="${ctaUrl}"
               class="inline-flex w-full items-center justify-center gap-2 px-4 py-2.5 rounded-xl bg-gradient-to-r from-blue-600 to-blue-500 text-white font-semibold hover:shadow-lg transition">
              ${safeText(ctaLabel)} <i class="fas fa-arrow-right"></i>
            </a>
          </div>
        </div>
      </div>
    `;

    // Cover: thumbnail si présent sinon gradient+icon (API: icon / color_gradient)
    const coverHtml = thumb
      ? `
        <div class="relative aspect-[16/9] bg-gray-100 overflow-hidden img-zoom">
          <img src="${thumb}" alt="${safeText(title)}"
               class="h-full w-full object-cover"
               loading="lazy"
               onerror="this.onerror=null; this.style.display='none'; this.parentElement.classList.add('bg-gradient-to-r'); this.parentElement.classList.add('${(course.color_gradient || 'from-blue-600 to-blue-500')}'); this.parentElement.innerHTML += '<div class=\\'absolute inset-0 flex items-center justify-center\\'><i class=\\'${(course.icon || 'fas fa-graduation-cap')} text-white text-5xl\\'></i></div>';"
          />
          ${badges}
        </div>
      `
      : `
        <div class="relative aspect-[16/9] bg-gradient-to-r ${(course.color_gradient || "from-blue-600 to-blue-500")} flex items-center justify-center">
          <i class="${(course.icon || "fas fa-graduation-cap")} text-white text-5xl"></i>
          ${badges}
        </div>
      `;

    return `
      <div class="bg-white rounded-2xl border border-gray-200 overflow-hidden card-lift tooltip">
        <a href="${detailUrl}" class="block">
          ${coverHtml}
        </a>

        <div class="p-4">
          <a href="${detailUrl}" class="block">
            <h3 class="text-[15px] font-extrabold text-slate-900 leading-snug line-clamp-2">${safeText(title)}</h3>
            ${subtitle ? `<p class="text-[13px] text-gray-600 mt-1 line-clamp-2">${safeText(subtitle)}</p>` : ""}
          </a>

          <div class="mt-2 flex items-center justify-between gap-3">
            <div class="min-w-0">
              <div class="text-[12px] text-gray-500 flex items-center gap-2">
                ${category ? `<span class="font-semibold text-gray-700 truncate">${safeText(category)}</span>` : ""}
                ${(category && courseType) ? `<span class="text-gray-300">•</span>` : ""}
                ${courseType ? `<span class="truncate">${safeText(courseType)}</span>` : ""}
              </div>

              <div class="mt-2 flex items-center gap-2">
                <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center shrink-0">
                  <span class="text-blue-700 font-extrabold text-xs">${safeText(instructorInitials)}</span>
                </div>
                <div class="min-w-0">
                  <div class="text-[12px] font-semibold text-gray-800 truncate">${safeText(instructorName)}</div>
                  <div class="text-[11px] text-gray-500 truncate">
                    ${publishedAt ? `Publié ${publishedAt}` : (status ? safeText(status) : "—")}
                  </div>
                </div>
              </div>
            </div>

            <!-- rating + price (Udemy-like: price visible) -->
            <div class="shrink-0 text-right">
              <div class="text-[12px] text-yellow-600 font-extrabold flex items-center justify-end gap-1">
                <i class="fas fa-star"></i> <span>${rating}</span>
              </div>
              ${isFree
                ? `<div class="text-[13px] font-extrabold text-green-700">Gratuit</div>`
                : `<div class="text-[13px] font-extrabold text-slate-900">${money(price, currency)}</div>`
              }
            </div>
          </div>

          <div class="mt-3 flex items-center justify-between text-[12px] text-gray-500">
            <div class="flex items-center gap-2">
              <span class="inline-flex items-center gap-1"><i class="far fa-clock"></i> ${safeText(course.duration || "—")}</span>
              <span class="text-gray-300">•</span>
              <span class="inline-flex items-center gap-1"><i class="fas fa-users"></i> ${enrolledCount}</span>
            </div>
            ${companyOnly ? `<span class="inline-flex items-center gap-1 text-purple-600 font-semibold"><i class="fas fa-building"></i> Entreprise</span>` : ``}
          </div>

          <a href="${ctaUrl}"
             class="block w-full mt-4 py-2.5 rounded-xl bg-gradient-to-r from-blue-600 to-blue-500 text-white text-center font-semibold hover:shadow-lg transition">
            ${safeText(ctaLabel)}
          </a>

          ${previewVideoUrl ? `
            <a href="${previewVideoUrl}" target="_blank" rel="noopener"
               class="mt-2 block text-center text-sm text-blue-600 hover:text-blue-700 font-medium">
              <i class="fas fa-circle-play mr-2"></i>Voir la vidéo de prévisualisation
            </a>
          ` : ``}
        </div>

        <!-- Hover panel -->
        ${hoverPanel}
      </div>
    `;
  }

  function normalizeApi(data) {
    // ✅ Ton API renvoie: success, count, total, limit, offset, results
    const results = data.results || data.courses || [];
    const total = (typeof data.total === "number") ? data.total :
                  (typeof data.count === "number") ? data.count :
                  results.length;

    const limit = (typeof data.limit === "number") ? data.limit : state.limit;
    const offset = (typeof data.offset === "number") ? data.offset : state.offset;

    return { results, total, limit, offset };
  }

  function applyClientSort(results) {
    // fallback tri côté front si l’API ne gère pas sort
    if (state.sort === "popular") {
      return [...results].sort((a,b) => {
        const ap = a.is_popular ? 1 : 0;
        const bp = b.is_popular ? 1 : 0;
        if (bp !== ap) return bp - ap;
        const ar = Number(a.rating || 0);
        const br = Number(b.rating || 0);
        if (br !== ar) return br - ar;
        return Number(b.enrolled_count || 0) - Number(a.enrolled_count || 0);
      });
    }
    if (state.sort === "recent") {
      return [...results].sort((a,b) => {
        const da = new Date(a.published_at || 0).getTime() || 0;
        const db = new Date(b.published_at || 0).getTime() || 0;
        return db - da;
      });
    }
    return results;
  }

  async function fetchCourses({reset = false} = {}) {
    if (state.loading) return;
    if (!state.hasMore && !reset) return;

    state.loading = true;

    if (reset) renderSkeleton(8);
    else showLoading(true);

    const params = buildParams({resetOffset: reset});
    const queryKey = params.toString();
    state.lastQueryKey = queryKey;

    try {
      const url = `${getEndpoint()}?${params.toString()}`;
      const res = await fetch(url, {headers: {"Accept": "application/json"}});
      if (!res.ok) throw new Error(`HTTP ${res.status}`);

      const data = await res.json();
      if (state.lastQueryKey !== queryKey) return;

      const norm = normalizeApi(data);
      const total = norm.total;
      const results = applyClientSort(norm.results);

      if (reset) els.container.innerHTML = "";
      els.count.textContent = String(total);

      if (!results.length && reset) {
        els.container.innerHTML = `
          <div class="col-span-full text-center py-12">
            <div class="w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4">
              <i class="fas fa-face-frown text-gray-500 text-2xl"></i>
            </div>
            <h4 class="text-lg font-semibold text-gray-800 mb-2">Aucun cours trouvé</h4>
            <p class="text-gray-600">Essayez un autre mot-clé ou modifiez les filtres.</p>
          </div>
        `;
      } else {
        els.container.insertAdjacentHTML("beforeend", results.map(renderCourseCard).join(""));
      }

      // Pagination: on se base sur total
      state.offset += state.limit;
      state.hasMore = state.offset < total;
      els.loadMore.classList.toggle("hidden", !state.hasMore);
    } catch (e) {
      console.error("fetchCourses error:", e);
      if (reset) {
        els.container.innerHTML = `
          <div class="col-span-full text-center py-12">
            <div class="w-16 h-16 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4">
              <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
            </div>
            <h4 class="text-lg font-semibold text-gray-800 mb-2">Erreur de chargement</h4>
            <p class="text-gray-600">Impossible de charger les cours. Réessayez plus tard.</p>
          </div>
        `;
      }
    } finally {
      showLoading(false);
      state.loading = false;
    }
  }

  function resetFilters() {
    els.q.value = "";
    els.level.value = "";
    els.type.value = "";
    els.pricing.value = "";
    if (els.mine && !els.mine.disabled) els.mine.value = "0";

    state.sort = "";
    state.offset = 0;
    state.hasMore = true;

    // reset UI sort buttons
    if (els.sortPopular) els.sortPopular.classList.remove("bg-slate-900","text-white");
    if (els.sortRecent) els.sortRecent.classList.remove("bg-slate-900","text-white");

    fetchCourses({reset: true});
  }

  const autoSearch = debounce(() => fetchCourses({reset: true}), 350);

  document.addEventListener("DOMContentLoaded", () => {
    fetchCourses({reset: true});

    els.apply.addEventListener("click", () => fetchCourses({reset: true}));
    els.reset.addEventListener("click", resetFilters);
    els.loadMore.addEventListener("click", () => fetchCourses({reset: false}));

    els.q.addEventListener("input", autoSearch);

    [els.level, els.type, els.pricing, els.mine].forEach(el => {
      if (!el) return;
      el.addEventListener("change", () => fetchCourses({reset: true}));
    });

    // Tri (toggle)
    els.sortPopular?.addEventListener("click", () => {
      state.sort = (state.sort === "popular") ? "" : "popular";
      // UI
      els.sortPopular.classList.toggle("bg-slate-900", state.sort === "popular");
      els.sortPopular.classList.toggle("text-white", state.sort === "popular");
      els.sortRecent.classList.remove("bg-slate-900", "text-white");
      fetchCourses({reset: true});
    });

    els.sortRecent?.addEventListener("click", () => {
      state.sort = (state.sort === "recent") ? "" : "recent";
      // UI
      els.sortRecent.classList.toggle("bg-slate-900", state.sort === "recent");
      els.sortRecent.classList.toggle("text-white", state.sort === "recent");
      els.sortPopular.classList.remove("bg-slate-900", "text-white");
      fetchCourses({reset: true});
    });
  });
</script>

</body>
</html>