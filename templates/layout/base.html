{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Best-Épargne — Catalogue de cours</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    * { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }

    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .line-clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    /* Udemy-like hover */
    .card-lift { transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease; }
    .card-lift:hover { transform: translateY(-2px); box-shadow: 0 18px 40px rgba(2, 6, 23, .10); border-color: rgba(148, 163, 184, .75); }

    /* Subtle image zoom */
    .img-zoom img { transition: transform .25s ease; }
    .card-lift:hover .img-zoom img { transform: scale(1.04); }

    /* Skeleton shimmer */
    @keyframes shimmer {
      0% { background-position: -600px 0; }
      100% { background-position: 600px 0; }
    }
    .skeleton {
      background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 37%, #f1f5f9 63%);
      background-size: 1200px 100%;
      animation: shimmer 1.2s infinite linear;
    }
  </style>
</head>

<body class="bg-slate-50 text-slate-900">

<!-- NAV -->
<nav class="bg-white border-b border-slate-200 sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
    <a href="/" class="flex items-center gap-3">
      <img src="{% static 'img/logo_img.png' %}" alt="Best-Épargne" class="h-9 w-auto"/>
      <div class="leading-tight">
        <div class="text-lg font-extrabold tracking-tight text-slate-900">Best-<span class="text-blue-600">Épargne</span></div>
        <div class="text-xs text-slate-500 -mt-0.5">Catalogue e-Learning</div>
      </div>
    </a>

    <div class="hidden md:flex items-center gap-2">
      <a href="#cours" class="px-3 py-2 rounded-lg text-sm font-semibold text-slate-700 hover:bg-slate-100">Cours</a>
      <a href="#faq" class="px-3 py-2 rounded-lg text-sm font-semibold text-slate-700 hover:bg-slate-100">FAQ</a>

      {% if user.is_authenticated %}
        <a href="{% url 'account_logout' %}" class="ml-2 px-4 py-2 rounded-lg text-sm font-semibold text-slate-700 hover:bg-slate-100">
          <i class="fa-solid fa-right-from-bracket mr-2"></i>Déconnexion
        </a>
      {% else %}
        <a href="{% url 'account_login' %}" class="ml-2 px-4 py-2 rounded-lg text-sm font-semibold text-slate-700 hover:bg-slate-100">
          Connexion
        </a>
        <a href="{% url 'account_signup' %}" class="px-4 py-2 rounded-lg text-sm font-semibold text-white bg-blue-600 hover:bg-blue-700">
          S’inscrire
        </a>
      {% endif %}
    </div>

    <button id="mobile-menu-btn" class="md:hidden p-2 rounded-lg hover:bg-slate-100">
      <i class="fa-solid fa-bars text-xl"></i>
    </button>
  </div>

  <div id="mobile-menu" class="md:hidden hidden border-t border-slate-200 bg-white">
    <div class="px-4 py-3 flex flex-col gap-2">
      <a href="#cours" class="px-3 py-2 rounded-lg text-sm font-semibold text-slate-700 hover:bg-slate-100">Cours</a>
      <a href="#faq" class="px-3 py-2 rounded-lg text-sm font-semibold text-slate-700 hover:bg-slate-100">FAQ</a>
      <div class="h-px bg-slate-200 my-2"></div>
      {% if user.is_authenticated %}
        <a href="{% url 'account_logout' %}" class="px-3 py-2 rounded-lg text-sm font-semibold text-slate-700 hover:bg-slate-100">
          <i class="fa-solid fa-right-from-bracket mr-2"></i>Déconnexion
        </a>
      {% else %}
        <a href="{% url 'account_login' %}" class="px-3 py-2 rounded-lg text-sm font-semibold text-slate-700 hover:bg-slate-100">Connexion</a>
        <a href="{% url 'account_signup' %}" class="px-3 py-2 rounded-lg text-sm font-semibold text-white bg-blue-600 hover:bg-blue-700 text-center">S’inscrire</a>
      {% endif %}
    </div>
  </div>
</nav>

<!-- HERO -->
<section class="bg-white">
  <div class="max-w-7xl mx-auto px-4 py-10 md:py-12">
    <div class="grid md:grid-cols-12 gap-8 items-start">
      <div class="md:col-span-8">
        <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight text-slate-900">
          Apprenez la <span class="text-blue-600">finance</span> avec des cours pratiques, comme sur Udemy.
        </h1>
        <p class="mt-3 text-slate-600 max-w-2xl">
          Parcourez le catalogue, filtrez par niveau, type, prix, et accédez aux pages de cours.
        </p>

        <div class="mt-6 flex flex-wrap gap-2">
          <span class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-slate-100 text-slate-700 text-sm font-semibold">
            <i class="fa-solid fa-shield-halved text-slate-500"></i>Plateforme sécurisée
          </span>
          <span class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-slate-100 text-slate-700 text-sm font-semibold">
            <i class="fa-solid fa-chart-line text-slate-500"></i>Analytique
          </span>
          <span class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-slate-100 text-slate-700 text-sm font-semibold">
            <i class="fa-solid fa-award text-slate-500"></i>Certifiant
          </span>
        </div>
      </div>

      <div class="md:col-span-4">
        <div class="bg-slate-900 text-white rounded-2xl p-6 shadow-sm">
          <div class="flex items-start justify-between gap-3">
            <div>
              <div class="text-sm text-slate-300">Catalogue</div>
              <div class="text-2xl font-extrabold mt-1"><span id="courses-count">0</span> cours</div>
            </div>
            <div class="h-10 w-10 rounded-xl bg-white/10 flex items-center justify-center">
              <i class="fa-solid fa-layer-group"></i>
            </div>
          </div>
          <p class="mt-3 text-sm text-slate-300">
            Astuce : utilisez la recherche + filtres pour affiner (niveau, prix, type).
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- FILTER BAR (Udemy-like) -->
<section id="cours" class="pb-6">
  <div class="max-w-7xl mx-auto px-4">
    <div class="bg-white border border-slate-200 rounded-2xl shadow-sm p-4 md:p-5">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-3">
        <div class="lg:col-span-2">
          <label class="text-xs font-bold text-slate-600">Recherche</label>
          <div class="mt-1 relative">
            <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
            <input id="filter-q" type="text" placeholder="Titre, sous-titre, description…"
                   class="w-full pl-10 pr-3 py-2.5 rounded-xl border border-slate-200 bg-slate-50 focus:outline-none focus:ring-2 focus:ring-blue-200">
          </div>
        </div>

        <div>
          <label class="text-xs font-bold text-slate-600">Niveau</label>
          <select id="filter-level"
                  class="mt-1 w-full px-3 py-2.5 rounded-xl border border-slate-200 bg-slate-50 focus:outline-none focus:ring-2 focus:ring-blue-200">
            <option value="">Tous</option>
            <option value="beginner">Débutant</option>
            <option value="intermediate">Intermédiaire</option>
            <option value="advanced">Avancé</option>
          </select>
        </div>

        <div>
          <label class="text-xs font-bold text-slate-600">Type</label>
          <select id="filter-type"
                  class="mt-1 w-full px-3 py-2.5 rounded-xl border border-slate-200 bg-slate-50 focus:outline-none focus:ring-2 focus:ring-blue-200">
            <option value="">Tous</option>
            <option value="ACADEMIQUE">Académique</option>
            <option value="PRO">Professionnel</option>
            <option value="BUSINESS">Entreprise</option>
            <option value="PERSONAL">Particulier</option>
          </select>
        </div>

        <div>
          <label class="text-xs font-bold text-slate-600">Tarif</label>
          <select id="filter-pricing"
                  class="mt-1 w-full px-3 py-2.5 rounded-xl border border-slate-200 bg-slate-50 focus:outline-none focus:ring-2 focus:ring-blue-200">
            <option value="">Tous</option>
            <option value="FREE">Gratuit</option>
            <option value="PAID">Payant</option>
            <option value="HYBRID">Hybride</option>
          </select>
        </div>

        <div class="flex items-end gap-2">
          <button id="apply-filters"
                  class="w-full px-5 py-2.5 rounded-xl bg-blue-600 text-white font-bold hover:bg-blue-700 transition">
            <i class="fa-solid fa-filter mr-2"></i>Filtrer
          </button>
          <button id="reset-filters"
                  class="px-4 py-2.5 rounded-xl bg-white border border-slate-200 text-slate-700 hover:bg-slate-50 transition">
            <i class="fa-solid fa-rotate-left"></i>
          </button>
        </div>
      </div>

      <div class="mt-4 flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
        <div class="text-sm text-slate-500">
          <i class="fa-regular fa-circle-question mr-2"></i>
          Les cartes affichent l’image <code class="px-1.5 py-0.5 rounded bg-slate-100">thumbnail_url</code> renvoyée par l’API.
        </div>
        <div class="flex gap-2">
          <button id="sort-popular"
                  class="px-4 py-2 rounded-xl bg-slate-100 text-slate-800 text-sm font-bold hover:bg-slate-200 transition">
            <i class="fa-solid fa-fire mr-2 text-slate-600"></i>Populaires
          </button>
          <button id="sort-recent"
                  class="px-4 py-2 rounded-xl bg-slate-100 text-slate-800 text-sm font-bold hover:bg-slate-200 transition">
            <i class="fa-regular fa-clock mr-2 text-slate-600"></i>Récents
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- GRID -->
<section class="pb-16">
  <div class="max-w-7xl mx-auto px-4">
    <div id="courses-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5"></div>

    <div id="courses-loading" class="hidden text-center py-10">
      <div class="inline-flex items-center gap-3 text-slate-600">
        <span class="inline-block h-8 w-8 rounded-full border-2 border-slate-300 border-t-slate-900 animate-spin"></span>
        Chargement…
      </div>
    </div>

    <div class="text-center mt-10">
      <button id="load-more"
              class="hidden mx-auto px-8 py-3 rounded-xl bg-white border border-slate-200 text-slate-800 font-bold hover:bg-slate-50 transition">
        Charger plus
      </button>
    </div>
  </div>
</section>

<!-- FAQ -->
<section id="faq" class="py-14 bg-white border-t border-slate-200">
  <div class="max-w-4xl mx-auto px-4">
    <div class="text-center mb-8">
      <h2 class="text-2xl md:text-3xl font-extrabold text-slate-900">FAQ</h2>
      <p class="text-slate-600 mt-2">Questions fréquentes sur la plateforme.</p>
    </div>

    <div class="space-y-3">
      <details class="bg-slate-50 border border-slate-200 rounded-2xl p-5">
        <summary class="cursor-pointer font-bold text-slate-900">Les cours sont-ils certifiants ?</summary>
        <p class="text-slate-600 mt-2">Oui, selon le cours. Les certificats apparaissent après validation.</p>
      </details>

      <details class="bg-slate-50 border border-slate-200 rounded-2xl p-5">
        <summary class="cursor-pointer font-bold text-slate-900">Comment afficher les images des cours ?</summary>
        <p class="text-slate-600 mt-2">L’API doit renvoyer <code class="px-1.5 py-0.5 rounded bg-white border">thumbnail_url</code>. Le front l’utilise directement.</p>
      </details>

      <details class="bg-slate-50 border border-slate-200 rounded-2xl p-5">
        <summary class="cursor-pointer font-bold text-slate-900">Puis-je filtrer par niveau et tarif ?</summary>
        <p class="text-slate-600 mt-2">Oui, utilisez les filtres en haut du catalogue.</p>
      </details>
    </div>
  </div>
</section>

<!-- FOOTER -->
<footer class="bg-slate-900 text-white">
  <div class="max-w-7xl mx-auto px-4 py-10">
    <div class="flex flex-col md:flex-row items-center justify-between gap-4">
      <div class="text-sm text-slate-300">© 2026 Best-Épargne. Tous droits réservés.</div>
      <div class="flex gap-4 text-sm">
        <a href="#" class="text-slate-300 hover:text-white">Mentions légales</a>
        <a href="#" class="text-slate-300 hover:text-white">Confidentialité</a>
        <a href="#" class="text-slate-300 hover:text-white">CGU</a>
      </div>
    </div>
  </div>
</footer>

<!-- Expose URLs -->
<script>
  window.BE = {
    isAuth: {% if user.is_authenticated %}true{% else %}false{% endif %},
    exploreUrl: "{% url 'landing_public_courses_explore' %}",
    learnerExploreUrl: "{% url 'api_learner_courses_explore' %}"
  };
</script>

<script>
  // Mobile menu
  document.getElementById('mobile-menu-btn')?.addEventListener('click', () => {
    document.getElementById('mobile-menu')?.classList.toggle('hidden');
  });

  // State
  const state = {
    limit: 20,
    offset: 0,
    loading: false,
    hasMore: true,
    sort: "", // "popular" | "recent" | ""
    lastKey: ""
  };

  const els = {
    container: document.getElementById("courses-container"),
    count: document.getElementById("courses-count"),
    loading: document.getElementById("courses-loading"),
    loadMore: document.getElementById("load-more"),
    apply: document.getElementById("apply-filters"),
    reset: document.getElementById("reset-filters"),
    q: document.getElementById("filter-q"),
    level: document.getElementById("filter-level"),
    type: document.getElementById("filter-type"),
    pricing: document.getElementById("filter-pricing"),
    sortPopular: document.getElementById("sort-popular"),
    sortRecent: document.getElementById("sort-recent"),
  };

  function debounce(fn, delay = 300) {
    let t = null;
    return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), delay); };
  }

  function endpoint() {
    if (window.BE?.isAuth && window.BE?.learnerExploreUrl) return window.BE.learnerExploreUrl;
    return window.BE?.exploreUrl || "#";
  }

  function showLoading(show) {
    els.loading.classList.toggle("hidden", !show);
  }

  function moneyXOF(amount) {
    const n = Number(amount || 0);
    return n.toLocaleString("fr-FR") + " FCFA";
  }

  function badge(label, tone="slate") {
    const map = {
      slate: "bg-slate-100 text-slate-800",
      green: "bg-green-100 text-green-700",
      blue: "bg-blue-100 text-blue-700",
      yellow: "bg-yellow-100 text-yellow-700",
      red: "bg-red-100 text-red-700",
      purple: "bg-purple-100 text-purple-700",
    };
    return `<span class="px-2.5 py-1 rounded-full text-[11px] font-extrabold ${map[tone] || map.slate}">${label}</span>`;
  }

  function pricingChip(course) {
    const pt = course.pricing_type;
    if (pt === "FREE" || Number(course.price) === 0) return badge("Gratuit", "green");
    if (pt === "PAID") return badge("Payant", "blue");
    if (pt === "HYBRID") return badge("Hybride", "yellow");
    return badge(course.pricing_type_label || "Tarif", "slate");
  }

  function levelChip(course) {
    const label = course.level_label || course.level || "Niveau";
    const tone = course.level_color || "slate";
    return badge(label, tone);
  }

  function thumbnailOrFallback(course) {
    // ✅ On utilise directement thumbnail_url fourni par l’API
    if (course.thumbnail_url) return course.thumbnail_url;

    // fallback simple si thumbnail_url est null
    // (un placeholder neutre — tu peux remplacer par un asset local si tu veux)
    const text = encodeURIComponent(course.title || "Cours");
    return `https://via.placeholder.com/640x360.png?text=${text}`;
  }

  function courseCard(course) {
    const title = course.title || "Cours";
    const subtitle = course.subtitle || "";
    const category = course.category_name || "";
    const instructor = course.instructor_name || "Formateur";
    const rating = (typeof course.rating === "number") ? course.rating.toFixed(1) : "—";
    const enrolled = Number(course.enrolled_count || 0).toLocaleString("fr-FR");
    const img = thumbnailOrFallback(course);

    // CTA (si tu veux gérer is_enrolled côté learner endpoint)
    const ctaUrl = course.preview_url || course.detail_url || "#";
    const ctaLabel = "Voir le cours";

    const priceHtml = (course.pricing_type === "FREE" || Number(course.price) === 0)
      ? `<div class="text-right font-extrabold text-slate-900">Gratuit</div>`
      : `<div class="text-right font-extrabold text-slate-900">${moneyXOF(course.price)}</div>`;

    return `
      <article class="bg-white border border-slate-200 rounded-2xl overflow-hidden card-lift">
        <a href="${ctaUrl}" class="block">
          <div class="relative aspect-[16/9] bg-slate-100 overflow-hidden img-zoom">
            <img src="${img}" alt="${title}" class="h-full w-full object-cover" loading="lazy"
                 onerror="this.onerror=null; this.src='https://via.placeholder.com/640x360.png?text=Best-Epargne';" />
            <div class="absolute top-3 left-3 flex flex-wrap gap-2">
              ${course.is_popular ? `<span class="px-2.5 py-1 rounded-full text-[11px] font-extrabold bg-black/80 text-white"><i class="fa-solid fa-star mr-1"></i>Populaire</span>` : ""}
              ${levelChip(course)}
              ${pricingChip(course)}
            </div>
          </div>
        </a>

        <div class="p-4">
          <a href="${ctaUrl}" class="block">
            <h3 class="font-extrabold text-[15px] leading-snug text-slate-900 line-clamp-2">${title}</h3>
            ${subtitle ? `<p class="mt-1 text-[13px] text-slate-600 line-clamp-2">${subtitle}</p>` : ""}
          </a>

          <div class="mt-2 text-[12px] text-slate-500 flex items-center gap-2">
            ${category ? `<span class="font-semibold text-slate-600">${category}</span><span class="text-slate-300">•</span>` : ""}
            <span>${course.course_type_label || course.course_type || ""}</span>
          </div>

          <div class="mt-2 text-[13px] text-slate-600 line-clamp-3">${course.description || ""}</div>

          <div class="mt-3 flex items-center justify-between gap-3">
            <div class="text-[12px] text-slate-600">
              <div class="font-bold text-slate-800">${instructor}</div>
              <div class="mt-0.5 flex items-center gap-2 text-[12px]">
                <span class="inline-flex items-center gap-1 text-amber-600 font-bold">
                  <i class="fa-solid fa-star"></i> ${rating}
                </span>
                <span class="text-slate-300">•</span>
                <span class="inline-flex items-center gap-1">
                  <i class="fa-solid fa-users text-slate-400"></i> ${enrolled}
                </span>
              </div>
            </div>
            ${priceHtml}
          </div>

          <div class="mt-3">
            <a href="${ctaUrl}"
               class="inline-flex w-full items-center justify-center gap-2 px-4 py-2.5 rounded-xl bg-slate-900 text-white font-extrabold hover:bg-slate-800 transition">
              ${ctaLabel} <i class="fa-solid fa-arrow-right"></i>
            </a>
          </div>
        </div>
      </article>
    `;
  }

  function skeletonCards(n = 8) {
    return Array.from({length: n}).map(() => `
      <div class="bg-white border border-slate-200 rounded-2xl overflow-hidden">
        <div class="aspect-[16/9] skeleton"></div>
        <div class="p-4 space-y-3">
          <div class="h-4 rounded skeleton w-5/6"></div>
          <div class="h-3 rounded skeleton w-4/6"></div>
          <div class="h-3 rounded skeleton w-full"></div>
          <div class="h-9 rounded-xl skeleton w-full"></div>
        </div>
      </div>
    `).join("");
  }

  function buildParams({resetOffset=false} = {}) {
    const q = (els.q.value || "").trim();
    const level = (els.level.value || "").trim();
    const type = (els.type.value || "").trim();
    const pricing = (els.pricing.value || "").trim();

    if (resetOffset) {
      state.offset = 0;
      state.hasMore = true;
    }

    const params = new URLSearchParams();
    params.set("limit", String(state.limit));
    params.set("offset", String(state.offset));

    if (q) params.set("q", q);
    if (level) params.set("level", level);
    if (type) params.set("course_type", type);       // ✅ selon tes vues, adapte si besoin
    if (pricing) params.set("pricing_type", pricing); // ✅ selon tes vues, adapte si besoin

    // Optionnel : tri côté API si tu l’as
    if (state.sort === "popular") params.set("sort", "popular");
    if (state.sort === "recent") params.set("sort", "recent");

    return params;
  }

  async function fetchCourses({reset=false} = {}) {
    if (state.loading) return;
    if (!state.hasMore && !reset) return;

    state.loading = true;

    if (reset) {
      els.container.innerHTML = skeletonCards(8);
    } else {
      showLoading(true);
    }

    const params = buildParams({resetOffset: reset});
    const key = params.toString();
    state.lastKey = key;

    try {
      const url = `${endpoint()}?${params.toString()}`;
      const res = await fetch(url, { headers: { "Accept": "application/json" } });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();

      if (state.lastKey !== key) return;

      const results = data.results || [];
      const total = (typeof data.total === "number") ? data.total : (typeof data.count === "number" ? data.count : results.length);

      els.count.textContent = String(total);

      if (reset) els.container.innerHTML = "";

      if (!results.length && reset) {
        els.container.innerHTML = `
          <div class="col-span-full bg-white border border-slate-200 rounded-2xl p-8 text-center">
            <div class="h-12 w-12 rounded-2xl bg-slate-100 mx-auto flex items-center justify-center mb-3">
              <i class="fa-regular fa-face-frown text-slate-500 text-xl"></i>
            </div>
            <div class="font-extrabold text-slate-900 text-lg">Aucun cours trouvé</div>
            <div class="text-slate-600 mt-1">Essayez une autre recherche ou modifiez les filtres.</div>
          </div>
        `;
      } else {
        els.container.insertAdjacentHTML("beforeend", results.map(courseCard).join(""));
      }

      state.offset += state.limit;
      state.hasMore = state.offset < total;

      els.loadMore.classList.toggle("hidden", !state.hasMore);
    } catch (e) {
      console.error("fetchCourses error:", e);
      if (reset) {
        els.container.innerHTML = `
          <div class="col-span-full bg-white border border-red-200 rounded-2xl p-8 text-center">
            <div class="h-12 w-12 rounded-2xl bg-red-50 mx-auto flex items-center justify-center mb-3">
              <i class="fa-solid fa-triangle-exclamation text-red-600 text-xl"></i>
            </div>
            <div class="font-extrabold text-slate-900 text-lg">Erreur de chargement</div>
            <div class="text-slate-600 mt-1">Impossible de charger les cours. Vérifiez l’API et réessayez.</div>
          </div>
        `;
      }
    } finally {
      showLoading(false);
      state.loading = false;
    }
  }

  function resetFilters() {
    els.q.value = "";
    els.level.value = "";
    els.type.value = "";
    els.pricing.value = "";
    state.sort = "";
    fetchCourses({reset: true});
  }

  const autoSearch = debounce(() => fetchCourses({reset: true}), 350);

  document.addEventListener("DOMContentLoaded", () => {
    fetchCourses({reset: true});

    els.apply.addEventListener("click", () => fetchCourses({reset: true}));
    els.reset.addEventListener("click", resetFilters);
    els.loadMore.addEventListener("click", () => fetchCourses({reset: false}));
    els.q.addEventListener("input", autoSearch);

    els.level.addEventListener("change", () => fetchCourses({reset: true}));
    els.type.addEventListener("change", () => fetchCourses({reset: true}));
    els.pricing.addEventListener("change", () => fetchCourses({reset: true}));

    els.sortPopular.addEventListener("click", () => {
      state.sort = (state.sort === "popular") ? "" : "popular";
      els.sortPopular.classList.toggle("bg-slate-900", state.sort === "popular");
      els.sortPopular.classList.toggle("text-white", state.sort === "popular");
      els.sortPopular.classList.toggle("bg-slate-100", state.sort !== "popular");
      els.sortPopular.classList.toggle("text-slate-800", state.sort !== "popular");
      // reset other
      els.sortRecent.classList.remove("bg-slate-900","text-white");
      els.sortRecent.classList.add("bg-slate-100","text-slate-800");
      fetchCourses({reset: true});
    });

    els.sortRecent.addEventListener("click", () => {
      state.sort = (state.sort === "recent") ? "" : "recent";
      els.sortRecent.classList.toggle("bg-slate-900", state.sort === "recent");
      els.sortRecent.classList.toggle("text-white", state.sort === "recent");
      els.sortRecent.classList.toggle("bg-slate-100", state.sort !== "recent");
      els.sortRecent.classList.toggle("text-slate-800", state.sort !== "recent");
      // reset other
      els.sortPopular.classList.remove("bg-slate-900","text-white");
      els.sortPopular.classList.add("bg-slate-100","text-slate-800");
      fetchCourses({reset: true});
    });
  });
</script>

</body>
</html>